clc; clear; close all;

pkg load image;

K = [
 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48;
 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31;
 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31;
 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32, 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32;
 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48;
 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31;
 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31;
 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32, 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32;
 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48;
 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31;
 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31;
 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 3, 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32;
 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48;
 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31;
 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31;
 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32, 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32;
 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48;
 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31;
 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31;
 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32, 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32;
 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48, 15, 18, 26, 48;
 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31, 14, 19, 27, 31;
 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31, 16, 21, 32, 31;
 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 3, 16, 25, 35, 32, 16, 25, 35, 32,16, 25, 35, 32
 ];
 
M = imread("barbara.jpg");
M = M(:, :, 1);
M = imresize(M, [12, 12]);
M = uint8(M);

subplot(1, 2, 1);
imshow(M);
title("Original");


Q = 20;
 
[HFC_R, HFC_I, Ur, Ui, LFC] = apply_fft_matrix(M, Q);

[Mr, Mi, W] = minimize_matrix(HFC_R, HFC_I);

[zero_matrix_R, zero_matrix_I] = count_zero_matrix(Mr, Mi);

[value_matrix_R, value_matrix_I] = get_value_matrix(Mr, Mi);

Mr2 = combine_zeros_values(value_matrix_R, zero_matrix_R);
Mi2 = combine_zeros_values(value_matrix_I, zero_matrix_I);

HFC_R2 = sequential_search_algorithm(Ur, Mr2, W);
HFC_I2 = sequential_search_algorithm(Ui, Mi2, W);

M2 = apply_inverse_fft_matrix(HFC_R, HFC_I, LFC, Q);


subplot(1, 2, 2);
imshow(M2);
title("Procesada");
